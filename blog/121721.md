---
title: Day 31 - Further progress with containers 🧯
date: 2021-12-17
description: Allowing for hot reload while orchestrating every component 🎻
tags: docker
---

# {{ $page.title }}

Last thursday, progress was halted at ensuring the availability of *debug mode*, ie. having any change in the code reflect itself automatically in the Docker container. This is very important, as otherwise one needs to rebuild the whole container *again*, taking precious time from a developer tight schedule. 🤓 

## Using Docker volumes 🐳

As per the [official documentation]("https://docs.docker.com/storage/volumes/"), *"Volumes are the preferred mechanism for persisting data generated by and used by Docker containers"*. I shall create one: `docker volume create --name myvolume`.

The next step entails building my dockerised application with this new volume; this can be done with the `-v` flag. [There is a tutorial on the FreeCodeCamp platoform](https://www.freecodecamp.org/news/how-to-enable-live-reload-on-docker-based-applications/), but I could not achieve the proper results; moreover, there is a staggering bias towards building containers with `docker-compose` instead of the lone `Dockerfile` builds, which makes me migrate to `docker-compose` altogether. 

## Detouring to `docker-compose` 🔀

I created a new directory `alexmakescodes-fullstack`, that houses two symbolic links to both the front-end and back-end directories, that lie in a different directory. The `docker-compose.yml` will be at the root of this new directory.

Sure enough, [the official documentation](https://docs.docker.com/compose/gettingstarted/#step-5-edit-the-compose-file-to-add-a-bind-mount) mentions Docker volumes as the solution to hot reloading — but, of course, it is *not that easy*.

I defined the following on the front-end `Dockerfile`:

```docker
FROM node:12.16-alpine

RUN mkdir amc
WORKDIR amc
COPY . .

RUN npm install

EXPOSE 8080

CMD npm run dev
```

and then, to make the hot reloading work, on the `docker-compose.yml`:

```yaml
version: "3.9"
services:
  front-end:
    build: front-end
    ports:
      - "8080:8080"
    volumes:
      - ./front-end:/amc
```

I think the `WORKDIR` variable must match the directory after the `:` on the `volumes` value, as such: 

```yaml
volumes:
  - ./<LOCAL DIRECTORY TO WATCH FOR CHANGES>:/<WORKDIR>
```

So...good! Hot reloading is working. 

## Final touches on the Django back-end! 🗣

To finally have the whole project running, there is still some work to do on ensuring security on the Django side, as well as some misc. problems to solve (admin page is not displaying CSS, and the comments must be regularly backed up). 

Regarding the change of environment, I just defined a boolean that changes with regard to the current machine's hostname: if it is `raspberry`, then it means production. There are probably better ways to go about this — a real environment variable... 🙄 — but this is fine for now. As for the lack of CSS, this is really not that big of a deal, because the only page that would have some CSS stylings is the `/admin` panel. Still, it needs some fixing.

Last, but certainly not least...Nginx still needs configuring — I believe as soon as I understand how it really works, then a major bottleneck of my deployment will be solved. 🎈
